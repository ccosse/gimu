{% extends "gimu_base.html" %}
{% block extra_head %}

<link href="{{ STATIC_URL }}css/site_base.css" rel="stylesheet"/>
<link rel="stylesheet" href="/static/gimu/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/gimu/css/bootstrap-switch.css">
<link rel="stylesheet" href="/static/gimu/css/ol.css" >
<link rel="stylesheet" href="/static/gimu/css/ol.css"/>
<link rel="stylesheet" href="/static/gimu/css/gimu.css"/>

<script src="/static/gimu/js/jquery-1.11.2.min.js"></script>
<script src="/static/gimu/js/bootstrap.min.js"></script>
<script src="/static/gimu/js/bootstrap-switch.js"></script>
<script src="/static/gimu/js/ol.js" type="text/javascript"></script>

<script src="/static/gimu/js/util.js" type="text/javascript"></script>
<script src="/static/gimu/js/gimu.js" type="text/javascript"></script>

<script type ="text/javascript">

window.gimu=null;

var get_box_info=function(idn){
	try{
		var bcr=document.getElementById(idn).getBoundingClientRect();
		var msg=idn+": "+bcr.left+", "+bcr.top+", "+bcr.width+", "+bcr.height;
		console.log(msg);
		return bcr;
	}
	catch(e){
		console.log(e);
	}
}
window.onresize=window.onorientationchange=function(e){
	if(document.location.pathname!="/")return;
	
	console.log(document.location.pathname);
	
	get_box_info("navbar");
	get_box_info("map_div");

	var navbar=document.getElementById("navbar");
	var bcr_navbar=navbar.getBoundingClientRect();
	
	var map_div=document.getElementById("map_div");
	var bcr_map_div=map_div.getBoundingClientRect();
	
	var footer=document.getElementById("gimu_footer");
	var bcr_footer=footer.getBoundingClientRect();
	
	map_div.style.top=parseInt(bcr_navbar.height)+"px";
	var new_map_height=parseInt(window.innerHeight-bcr_navbar.height-bcr_footer.height);
	map_div.style.height=new_map_height+"px";
	get_box_info("map_div");
	
	footer.style.top=parseInt(bcr_navbar.height + new_map_height)+"px";
	
	if(!window.gimu)return;
	var res=compute_resolution(window.gimu.get_bbox(),false,window.innerWidth,new_map_height);
	window.map.getView().setResolution(res);
//	window.map.render();
}
var init=function(e){
	if(document.location.pathname=="/"){
		
		window.onresize();
				
		window.gimu=new GIMU("map_div");
		console.log("GIMU Object Created");
		
		window.onresize();
	}
}


</script>

{% endblock %}
